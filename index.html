<!DOCTYPE html>
<html lang="pt-br">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>PPA SimVein • Simulador de Coleta</title>
  <meta name="theme-color" content="#0d1b2a" />
  <link rel="manifest" href="/manifest.webmanifest?v=15" />
  <link rel="stylesheet" href="/styles.css?v=15" />
  <script src="https://aframe.io/releases/1.5.0/aframe.min.js"></script>
</head>
<body>
  <header class="app-header">
    <div class="brand">
      <img src="/public/assets/branding/logo-sim.png" alt="PPA SimVein"/>
      <img src="/public/assets/branding/logo-capacita.png" alt="Capacita+"/>
    </div>
    <nav class="nav">
      <button data-tab="welcome" class="btn">Boas-vindas</button>
      <button data-tab="paciente" class="btn ghost">Ficha</button>
      <button data-tab="solicitacao" class="btn ghost">Solicitação</button>
      <button data-tab="biosseg" class="btn ghost">Biossegurança</button>
      <button data-tab="dispositivo" class="btn ghost">Dispositivo</button>
      <button data-tab="punicao" class="btn ghost">Garrote & Ângulo</button>
      <button data-tab="sequencia" class="btn ghost">Sequência</button>
      <button data-tab="aplicacoes" class="btn ghost">Quebra-cabeça</button>
      <button data-tab="tabelas" class="btn ghost">Tabelas</button>
      <button data-tab="relatorio" class="btn ghost">Relatório</button>
      <button id="btn-settings" class="btn ghost" title="Configurações">⚙️</button>
    </nav>
  </header>

  <audio id="audio-ambiente" src="/public/audios/audio-ambiente.mp3?v=15" loop preload="auto"></audio>

  <main class="content" style="grid-template-columns: 1fr 340px; gap: 12px;">
    <div>
      <section id="tab-welcome" class="tab active">
        <h2>Boas-vindas</h2>
        <div class="row" style="align-items:flex-start;gap:16px">
          <img src="/public/assets/hero-boas-vindas.png" alt="Boas-vindas" style="max-width:340px;border-radius:12px"/>
          <div>
            <p>Ouça a introdução e, quando quiser, clique em Começar.</p>
            <div class="row" style="margin:8px 0 12px">
              <button class="btn" data-audio="/public/audios/audio-boas-vindas.mp3">▶ Boas-vindas</button>
              <button id="welcome-start" class="btn ghost">Começar</button>
            </div>
          </div>
        </div>
      </section>

      <section id="tab-paciente" class="tab">
        <h2>Ficha do Paciente</h2>
        <form id="form-paciente" class="form">
          <div class="grid-2">
            <label>Nome
              <input name="nome" required placeholder="Paciente Exemplo"/>
            </label>
            <label>Data de Nascimento
              <input name="nasc" type="date" required/>
            </label>
            <label>Sexo
              <select name="sexo">
                <option>F</option><option>M</option><option>Outro</option>
              </select>
            </label>
            <label>Nome da mãe
              <input name="mae" placeholder="Nome da mãe"/>
            </label>
            <label>Documento de identificação
              <input name="doc" placeholder="RG/CPF/Outro"/>
            </label>
            <label>Unidade de saúde (origem)
              <input name="unidade" placeholder="UBS/UPA/Hospital"/>
            </label>
          </div>
          <h3>Coleta</h3>
          <div class="grid-2">
            <label>Exames solicitados (descrição)
              <input name="exames-desc" placeholder="Ex.: Hemograma, Glicose, TSH"/>
            </label>
            <label>Data e hora da coleta
              <input name="datahora" type="datetime-local"/>
            </label>
            <label>Tipo de amostra
              <select name="amostra">
                <option>Sangue venoso</option>
                <option>Sangue capilar</option>
                <option>Soro</option>
                <option>Plasma</option>
                <option>Outros</option>
              </select>
            </label>
            <label>Alergias
              <input name="alergias" placeholder="Sem alergias"/>
            </label>
          </div>
          <label>Braço preferencial
            <select name="braco"><option>Direito</option><option>Esquerdo</option></select>
          </label>
          <div class="row">
            <label class="check"><input type="checkbox" name="id1"/> Documento conferido</label>
            <label class="check"><input type="checkbox" name="id2"/> Confirmação verbal</label>
            <label class="check"><input type="checkbox" name="consent"/> Consentimento informado</label>
          </div>
          <button type="button" id="btn-salvar-paciente" class="btn">Salvar ficha</button>
        </form>
      </section>

      <section id="tab-solicitacao" class="tab">
        <h2>Solicitação Médica</h2>
        <p>Selecione os exames solicitados:</p>
        <div id="exames" class="chips">
          <label><input type="checkbox" value="TP/TTPa"/> TP / TTPa</label>
          <label><input type="checkbox" value="Hemograma"/> Hemograma</label>
          <label><input type="checkbox" value="Glicose"/> Glicose</label>
          <label><input type="checkbox" value="Eletrólitos"/> Eletrólitos</label>
          <label><input type="checkbox" value="Sorologia/Hormônios"/> Sorologia / Hormônios</label>
          <label><input type="checkbox" value="Hemocultura"/> Hemocultura</label>
          <label><input type="checkbox" value="VHS"/> VHS</label>
        </div>
        <button id="btn-deduzir" class="btn">Deduzir tubos necessários</button>
        <div id="deduzidos" class="pill"></div>
      </section>

      <section id="tab-biosseg" class="tab">
        <h2>Biossegurança (Pré / Durante / Pós)</h2>
        <div class="grid-3 checklist">
          <div>
            <h3>Pré</h3>
            <label class="check"><input type="checkbox" data-score="epi"/> EPIs completos</label>
            <label class="check"><input type="checkbox" data-score="maos"/> Higienização das mãos</label>
            <label class="check"><input type="checkbox" data-score="bancada"/> Bancada organizada</label>
          </div>
          <div>
            <h3>Durante</h3>
            <label class="check"><input type="checkbox" data-score="antissepsia"/> Antissepsia correta</label>
            <label class="check"><input type="checkbox" data-score="garrote"/> Garrote ≤ 60s</label>
            <label class="check"><input type="checkbox" data-score="perfuro"/> Caixa perfuro-cortante</label>
          </div>
          <div>
            <h3>Pós</h3>
            <label class="check"><input type="checkbox" data-score="rotulo"/> Rotulagem correta</label>
            <label class="check"><input type="checkbox" data-score="compressao"/> Compressão local</label>
            <label class="check"><input type="checkbox" data-score="descarte"/> Descarte adequado</label>
          </div>
        </div>

        <div class="audio-controls" style="margin-top:12px">
          <button class="btn ghost" data-audio="/public/audios/audio-erros.mp3">▶ Erros comuns</button>
        </div>

        <div class="row" style="gap:12px;margin-top:12px;flex-wrap:wrap">
          <img src="/public/assets/erro-veia.png" alt="Erro de veia" style="height:90px;border-radius:10px"/>
          <img src="/public/assets/erro-coagulo.png" alt="Coágulo" style="height:90px;border-radius:10px"/>
          <img src="/public/assets/erro-hemolise.png" alt="Hemólise" style="height:90px;border-radius:10px"/>
          <img src="/public/assets/erro-sem-tubo.png" alt="Sem tubo" style="height:90px;border-radius:10px"/>
          <img src="/public/assets/erro-rotulo.png" alt="Rótulo incorreto" style="height:90px;border-radius:10px"/>
        </div>
      </section>

      <section id="tab-dispositivo" class="tab">
        <h2>Seleção de Dispositivo</h2>
        <div class="grid-3 cards" id="disp-cards">
          <label class="card"><input type="radio" name="disp" value="agulha"/><span>Agulha</span></label>
          <label class="card"><input type="radio" name="disp" value="scalp"/><span>Scalp (borboleta)</span></label>
          <label class="card"><input type="radio" name="disp" value="cateter"/><span>Cateter periférico</span></label>
        </div>
        <div id="disp-tip" class="badge" style="margin-top:8px"></div>
      </section>

      <section id="tab-punicao" class="tab">
        <h2>Garrote & Ângulo</h2>
        <div class="row gap">
          <div class="box">
            <h3>Garrote</h3>
            <div class="row">
              <button id="garrote-start" class="btn">Iniciar</button>
              <button id="garrote-stop" class="btn ghost" disabled>Parar</button>
              <div id="garrote-timer" class="timer">00:00</div>
            </div>
            <div id="garrote-alert" class="alert" hidden>⚠️ Garrote excedeu 60s!</div>
          </div>
          <div class="box">
            <h3>Ângulo da Punção</h3>
            <input type="range" id="angle" min="0" max="90" value="30" />
            <div>Ângulo: <span id="angle-val">30°</span></div>
            <div id="angle-feedback" class="badge">Alvo: 30–45°</div>
          </div>
        </div>

        <div class="scene-360 box">
          <h3>Seleção de Veia (360°)</h3>
          <div id="missing360" class="alert" hidden>⚠️ Coloque public/assets/arm-360.png (2:1).</div>
          <a-scene embedded vr-mode-ui="enabled:false" renderer="antialias:true">
            <a-assets>
              <img id="arm360" src="/public/assets/arm-360.png?v=15" crossorigin="anonymous" />
            </a-assets>
            <a-sky id="sky" src="#arm360" rotation="0 -90 0"></a-sky>
            <a-entity camera look-controls>
              <a-entity cursor="rayOrigin: mouse" raycaster="objects: .hotspot"></a-entity>
            </a-entity>
            <a-entity class="hotspot" position="0 1.6 -3" geometry="primitive: sphere; radius: 0.06" material="color:#2ec4b6; emissive:#2ec4b6; opacity:.85" data-title="Mediana Cubital" data-text="Geralmente mais estável; bom calibre e localização."></a-entity>
            <a-entity class="hotspot" position="-0.8 1.5 -2.5" geometry="primitive: sphere; radius: 0.06" material="color:#6c63ff; emissive:#6c63ff; opacity:.85" data-title="Cefálica" data-text="Boa alternativa; atenção à rolagem."></a-entity>
            <a-entity class="hotspot" position="0.8 1.5 -2.5" geometry="primitive: sphere; radius: 0.06" material="color:#f59f00; emissive:#f59f00; opacity:.85" data-title="Basílica" data-text="Mais medial; opte se as outras não forem viáveis."></a-entity>
          </a-scenE>
          <div class="legend">
            <span class="dot teal"></span> Mediana
            <span class="dot purple"></span> Cefálica
            <span class="dot amber"></span> Basílica
          </div>
          <div id="hotspot-panel" class="box" hidden>
            <h4 id="hs-title">Veia</h4>
            <p id="hs-text"></p>
          </div>
        </div>
      </section>

      <section id="tab-sequencia" class="tab">
        <h2>Sequência de Coleta</h2>
        <p>Arraste os tubos para a área em ordem correta e clique em Validar.</p>
        <div class="quiz">
          <div class="bank" id="tube-bank">
            <img draggable="true" class="tube" data-id="1-hemocultura" src="/public/assets/tubes/hemocultura.png?v=15" alt="Hemocultura">
            <img draggable="true" class="tube" data-id="2-citrato" src="/public/assets/tubes/citrato-azul.png?v=15" alt="Citrato (Azul)">
            <img draggable="true" class="tube tube-vhs" data-id="3-vhs" src="/public/assets/tubes/vhs-preto.png?v=15" alt="VHS (Preto)" style="display:none">
            <img draggable="true" class="tube" data-id="4-soro" src="/public/assets/tubes/soro-vermelho.png?v=15" alt="Soro (Vermelho/Amarelo)">
            <img draggable="true" class="tube" data-id="5-heparina" src="/public/assets/tubes/heparina-verde.png?v=15" alt="Heparina (Verde)">
            <img draggable="true" class="tube" data-id="6-edta" src="/public/assets/tubes/edta-roxo.png?v=15" alt="EDTA (Roxo)">
            <img draggable="true" class="tube" data-id="7-fluoreto" src="/public/assets/tubes/fluoreto-cinza.png?v=15" alt="Fluoreto (Cinza)">
          </div>
          <div class="drop" id="tube-drop" aria-label="Área de Montagem"></div>
        </div>
        <div class="quiz-actions">
          <button id="btn-reset" class="btn ghost">↺ Resetar</button>
          <button id="btn-validate" class="btn">Validar</button>
          <button class="btn ghost" data-audio="/public/audios/audio-selecao-de-tubos.mp3">▶ Sequência (narração)</button>
        </div>
        <p id="quiz-feedback" class="feedback"></p>
      </section>

      <section id="tab-aplicacoes" class="tab">
        <h2>Tubos & Aplicações</h2>
        <p>Associe cada tubo à sua finalidade/exemplos.</p>
        <div class="puzzle">
          <div class="left" id="puzzle-left">
            <div class="piece" draggable="true" data-key="hemocultura">Hemocultura (Microbiologia)</div>
            <div class="piece" draggable="true" data-key="citrato">Azul – Citrato (Coagulação: TP/TTPa)</div>
            <div class="piece" draggable="true" data-key="soro">Vermelho/Amarelo – Soro (Bioquímica/Sorologia/Hormônios)</div>
            <div class="piece" draggable="true" data-key="heparina">Verde – Heparina (Bioquímica/Eletrólitos)</div>
            <div class="piece" draggable="true" data-key="edta">Roxo – EDTA (Hematologia: Hemograma)</div>
            <div class="piece" draggable="true" data-key="fluoreto">Cinza – Fluoreto + EDTA (Glicose/Lactato)</div>
            <div class="piece" draggable="true" data-key="vhs">Preto – VHS (Velocidade de Hemossedimentação)</div>
          </div>
          <div class="right" id="puzzle-right">
            <div class="slot" data-accept="hemocultura">Microbiologia (bactérias/fungos)</div>
            <div class="slot" data-accept="citrato">Coagulação (TP, TTPa)</div>
            <div class="slot" data-accept="soro">Bioquímica / Sorologia / Hormônios</div>
            <div class="slot" data-accept="heparina">Bioquímica / Eletrólitos</div>
            <div class="slot" data-accept="edta">Hematologia (Hemograma)</div>
            <div class="slot" data-accept="fluoreto">Glicose / Lactato (inibe glicólise)</div>
            <div class="slot" data-accept="vhs">Velocidade de Hemossedimentação (VHS)</div>
          </div>
        </div>
        <div class="audio-controls" style="margin-top:8px">
          <button class="btn ghost" data-audio="/public/audios/audio-selecao-de-tubos.mp3">▶ Seleção de tubos (narração)</button>
        </div>
      </section>

      <section id="tab-tabelas" class="tab">
        <h2>Tabelas de Referência</h2>
        <div class="tables">
          <details open>
            <summary>Hemograma — Homens</summary>
            <ul>
              <li>Hemácias: 4,2 a 5,9 milhões/µL</li>
              <li>Hemoglobina: 13,0 a 18,0 g/dL</li>
              <li>Hematócrito: 38 a 52%</li>
              <li>VCM: 80 a 100 fL</li>
              <li>HCM: 27 a 32 pg</li>
              <li>CHCM: 31 a 36 g/dL</li>
              <li>RDW: 10 a 16%</li>
              <li>Leucócitos totais: 4.000 a 11.000/µL</li>
              <li>Neutrófilos bastonetes: 0 a 800/µL</li>
              <li>Neutrófilos segmentados: 1.600 a 8.000/µL</li>
              <li>Linfócitos: 900 a 4.000/µL</li>
              <li>Monócitos: 100 a 1.000/µL</li>
              <li>Eosinófilos: 0 a 500/µL</li>
              <li>Basófilos: 0 a 200/µL</li>
              <li>Plaquetas: 140.000 a 450.000/µL</li>
            </ul>
          </details>
          <details>
            <summary>Hemograma — Mulheres</summary>
            <ul>
              <li>Hemácias: 3,9 a 5,4 milhões/µL</li>
              <li>Hemoglobina: 12,0 a 16,0 g/dL</li>
              <li>Hematócrito: 35 a 47%</li>
              <li>VCM: 80 a 100 fL</li>
              <li>HCM: 27 a 32 pg</li>
              <li>CHCM: 31 a 36 g/dL</li>
              <li>RDW: 10 a 16%</li>
              <li>Leucócitos totais: 4.000 a 11.000/µL</li>
              <li>Neutrófilos bastonetes: 0 a 800/µL</li>
              <li>Neutrófilos segmentados: 1.600 a 8.000/µL</li>
              <li>Linfócitos: 900 a 4.000/µL</li>
              <li>Monócitos: 100 a 1.000/µL</li>
              <li>Eosinófilos: 0 a 500/µL</li>
              <li>Basófilos: 0 a 200/µL</li>
              <li>Plaquetas: 150.000 a 450.000/µL</li>
            </ul>
          </details>
          <details>
            <summary>Leucograma na gravidez</summary>
            <ul>
              <li>1º tri — Leucócitos: 5.700–13.600/µL; Neutrófilos: 3.600–10.100/µL; Linfócitos: 1.100–3.600/µL</li>
              <li>2º tri — Leucócitos: 5.600–14.800/µL; Neutrófilos: 3.800–12.300/µL; Linfócitos: 900–3.900/µL</li>
              <li>3º tri — Leucócitos: 5.900–16.900/µL; Neutrófilos: 3.900–13.100/µL; Linfócitos: 100–3.600/µL</li>
            </ul>
          </details>
          <details>
            <summary>Observação</summary>
            <ul>
              <li>Os valores podem variar conforme laboratório, kits e equipamentos utilizados.</li>
            </ul>
          </details>
        </div>
      </section>

      <section id="tab-relatorio" class="tab">
        <h2>Relatório de Desempenho</h2>
        <div id="relato"></div>
        <button id="btn-gerar-relato" class="btn">Gerar Relatório</button>
      </section>
    </div>

    <aside class="tab box" style="height: fit-content;">
      <div class="row" style="gap:10px; align-items:center;">
        <img src="/public/assets/branding/avatar-tutor.png?v=15" alt="Tutor" style="width:56px;height:56px;border-radius:50%;object-fit:cover">
        <h3 style="margin:0">Tutor IA</h3>
      </div>
      <div id="tutor-feed" style="margin-top:8px;max-height:240px;overflow:auto;"></div>
      <div class="row" style="margin-top:8px">
        <input id="tutor-input" placeholder="Pergunte, responda ao quiz, peça correção…" style="flex:1;padding:8px;border-radius:10px;border:1px solid rgba(255,255,255,.15);background:#0c182b;color:#e6f0ff"/>
        <button id="tutor-ask" class="btn">Enviar</button>
      </div>
      <button id="tutor-corrigir" class="btn ghost" style="margin-top:8px">Corrigir sequência</button>
    </aside>
  </main>

  <footer class="app-footer">
    <div class="left">
      <small>© 2025 • Material educacional. Não substitui treinamento supervisionado.</small>
    </div>
    <div class="right">
      <img src="/public/assets/branding/logo-haras.png?v=15" alt="HarasTech"/>
      <small>Desenvolvido por HarasTech • <a href="mailto:harastech@outlook.com">harastech@outlook.com</a></small>
    </div>
  </footer>

  <dialog id="settings">
    <h3>Configurações</h3>
    <label class="row">
      <span>Áudio ambiente</span>
      <input type="checkbox" id="toggle-ambiente"/>
    </label>
    <label>Volume do ambiente
      <input type="range" id="ambient-vol" min="0" max="100" value="35"/>
    </label>
    <div class="row" style="margin-top:6px">
      <button id="test-welcome" class="btn ghost">▶ Testar Boas-vindas</button>
    </div>
    <div class="row end" style="margin-top:8px">
      <button id="save-settings" class="btn">Salvar</button>
      <button id="close-settings" class="btn ghost">Fechar</button>
    </div>
  </dialog>

  <script src="/scripts.js?v=15" defer></script>
</body>
</html>
