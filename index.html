<!DOCTYPE html>
<html lang="pt-br">
<head>
  <meta charset="utf-8"/>
  <meta name="viewport" content="width=device-width, initial-scale=1"/>
  <title>PPA SimVein • Simulador de Coleta</title>
  <meta name="theme-color" content="#0d1b2a"/>
  <link rel="manifest" href="/manifest.webmanifest?v=30"/>
  <link rel="stylesheet" href="/styles.css?v=30"/>
  <script src="https://aframe.io/releases/1.5.0/aframe.min.js"></script>
</head>
<body>
  <header class="app-header">
    <div class="brand">
      <img src="/public/assets/branding/logo-sim.png" alt="PPA SimVein" style="height:48px"/>
      <img src="/public/assets/branding/logo-capacita.png" alt="Capacita+" style="height:48px"/>
    </div>
    <nav class="nav">
      <button data-tab="welcome" class="btn">Boas-vindas</button>
      <button data-tab="paciente" class="btn ghost">Ficha</button>
      <button data-tab="solicitacao" class="btn ghost">Solicitação</button>
      <button data-tab="biosseg" class="btn ghost">Biossegurança</button>
      <button data-tab="gasometria" class="btn ghost">Gasometria</button>
      <button data-tab="hemato" class="btn ghost">Hemato-Imune</button>
      <button data-tab="sequencia" class="btn ghost">Sequência</button>
      <button data-tab="aplicacoes" class="btn ghost">Quebra-cabeça</button>
      <button data-tab="indices" class="btn ghost">Índices</button>
      <button data-tab="tutor" class="btn" style="background:#2ec4b6">Tutor</button>
      <button data-tab="glossario" class="btn ghost">Glossário</button>
      <button id="btn-settings" class="btn ghost" title="Configurações">⚙️</button>
    </nav>
  </header>

  <audio id="audio-ambiente" src="/public/audios/audio-ambiente.mp3?v=30" loop preload="auto"></audio>

  <main class="content" style="grid-template-columns: 1fr 340px; gap: 12px;">
    <div>
      <section id="tab-welcome" class="tab active">
        <h2>Boas-vindas</h2>
        <div class="row" style="align-items:flex-start;gap:16px">
          <img src="/public/assets/hero-boas-vindas.png" alt="Boas-vindas" style="max-width:360px;border-radius:12px"/>
          <div>
            <p>Ouça a introdução e clique em Começar.</p>
            <div class="row" style="margin:8px 0 12px">
              <button class="btn" data-audio="/public/audios/audio-boas-vindas.mp3">▶ Boas-vindas</button>
              <button id="welcome-start" class="btn ghost">Começar</button>
            </div>
          </div>
        </div>
      </section>

      <section id="tab-paciente" class="tab">
        <h2>Ficha do Paciente</h2>
        <form id="form-paciente" class="form">
          <div class="grid-2">
            <label>Nome
              <input name="nome" required placeholder="Paciente Exemplo"/>
            </label>
            <label>Data de Nascimento
              <input name="nasc" type="date" required/>
            </label>
            <label>Sexo
              <select name="sexo"><option>F</option><option>M</option><option>Outro</option></select>
            </label>
            <label>Nome da mãe
              <input name="mae" placeholder="Nome da mãe"/>
            </label>
            <label>Documento de identificação
              <input name="doc" placeholder="RG/CPF/Outro"/>
            </label>
            <label>Unidade de saúde (origem)
              <input name="unidade" placeholder="UBS/UPA/Hospital"/>
            </label>
          </div>
          <h3>Coleta</h3>
          <div class="grid-2">
            <label>Exames solicitados (descrição)
              <input name="exames-desc" placeholder="Ex.: Hemograma, Glicose, TSH"/>
            </label>
            <label>Data e hora da coleta
              <input name="datahora" type="datetime-local"/>
            </label>
            <label>Tipo de amostra
              <select name="amostra">
                <option>Sangue venoso</option><option>Sangue capilar</option><option>Soro</option><option>Plasma</option><option>Outros</option>
              </select>
            </label>
            <label>Alergias
              <input name="alergias" placeholder="Sem alergias"/>
            </label>
          </div>
          <label>Braço preferencial
            <select name="braco"><option>Direito</option><option>Esquerdo</option></select>
          </label>
          <div class="row">
            <label class="check"><input type="checkbox" name="id1"/> Documento conferido</label>
            <label class="check"><input type="checkbox" name="id2"/> Confirmação verbal</label>
            <label class="check"><input type="checkbox" name="consent"/> Consentimento informado</label>
          </div>
          <button type="button" id="btn-salvar-paciente" class="btn">Salvar ficha</button>
        </form>
      </section>

      <section id="tab-solicitacao" class="tab">
        <h2>Solicitação Médica</h2>
        <div id="exames" class="chips">
          <label><input type="checkbox" value="TP/TTPa"/> TP / TTPa</label>
          <label><input type="checkbox" value="Hemograma"/> Hemograma</label>
          <label><input type="checkbox" value="Glicose"/> Glicose</label>
          <label><input type="checkbox" value="Eletrólitos"/> Eletrólitos</label>
          <label><input type="checkbox" value="Sorologia/Hormônios"/> Sorologia / Hormônios</label>
          <label><input type="checkbox" value="Hemocultura"/> Hemocultura</label>
          <label><input type="checkbox" value="VHS"/> VHS</label>
        </div>
        <button id="btn-deduzir" class="btn">Deduzir tubos necessários</button>
        <div id="deduzidos" class="pill"></div>
      </section>

      <section id="tab-biosseg" class="tab">
        <h2>Biossegurança (Pré / Durante / Pós)</h2>
        <div class="grid-3 checklist">
          <div>
            <h3>Pré</h3>
            <label class="check"><input type="checkbox" data-score="epi"/> EPIs completos</label>
            <label class="check"><input type="checkbox" data-score="maos"/> Higienização das mãos</label>
            <label class="check"><input type="checkbox" data-score="bancada"/> Bancada organizada</label>
          </div>
          <div>
            <h3>Durante</h3>
            <label class="check"><input type="checkbox" data-score="antissepsia"/> Antissepsia correta</label>
            <label class="check"><input type="checkbox" data-score="garrote"/> Garrote ≤ 60s</label>
            <label class="check"><input type="checkbox" data-score="perfuro"/> Caixa perfuro-cortante</label>
          </div>
          <div>
            <h3>Pós</h3>
            <label class="check"><input type="checkbox" data-score="rotulo"/> Rotulagem correta</label>
            <label class="check"><input type="checkbox" data-score="compressao"/> Compressão local</label>
            <label class="check"><input type="checkbox" data-score="descarte"/> Descarte adequado</label>
          </div>
        </div>
        <div class="audio-controls" style="margin-top:12px">
          <button class="btn ghost" data-audio="/public/audios/audio-erros.mp3">▶ Erros comuns</button>
        </div>
        <div class="row" style="gap:12px;margin-top:12px;flex-wrap:wrap">
          <img src="/public/assets/erro-veia.png" alt="Erro de veia" style="height:90px;border-radius:10px"/>
          <img src="/public/assets/erro-coagulo.png" alt="Coágulo" style="height:90px;border-radius:10px"/>
          <img src="/public/assets/erro-hemolise.png" alt="Hemólise" style="height:90px;border-radius:10px"/>
          <img src="/public/assets/erro-sem-tubo.png" alt="Sem tubo" style="height:90px;border-radius:10px"/>
          <img src="/public/assets/erro-rotulo.png" alt="Rótulo incorreto" style="height:90px;border-radius:10px"/>
        </div>
      </section>

      <section id="tab-gasometria" class="tab">
        <h2>Gasometria Arterial</h2>
        <div class="audio-controls" style="margin-bottom:12px">
          <button class="btn" data-audio="/public/audios/audio-gasometria.mp3">▶ Áudio: Gasometria</button>
        </div>
        <div class="box" id="gaso-quiz">
          <h3>Quizzes</h3>
          <div id="gq-q" class="badge" style="margin-bottom:8px"></div>
          <div id="gq-options" class="grid-3" style="margin-bottom:8px"></div>
          <div class="row">
            <button id="gq-next" class="btn">Próxima</button>
            <div id="gq-feedback" class="feedback"></div>
          </div>
        </div>
        <div class="box" style="margin-top:12px">
          <h3>Casos Clínicos</h3>
          <div id="gaso-cases" class="tables"></div>
        </div>
      </section>

      <section id="tab-hemato" class="tab">
        <h2>Hemato-Imune</h2>
        <div class="audio-controls" style="margin-bottom:12px">
          <button class="btn ghost" data-audio="/public/audios/audio-hemato-imune.mp3">▶ Hematologia/Imuno</button>
          <button class="btn ghost" data-audio="/public/audios/audio-bioquimica-clinica.mp3">▶ Bioquímica Clínica</button>
        </div>
        <div class="box" id="hemi-quiz">
          <h3>Quizzes</h3>
          <div id="hq-q" class="badge" style="margin-bottom:8px"></div>
          <div id="hq-options" class="grid-3" style="margin-bottom:8px"></div>
          <div class="row">
            <button id="hq-next" class="btn">Próxima</button>
            <div id="hq-feedback" class="feedback"></div>
          </div>
        </div>
        <div class="box" style="margin-top:12px">
          <h3>Casos Clínicos</h3>
          <div id="hemi-cases" class="tables"></div>
        </div>
      </section>

      <section id="tab-sequencia" class="tab">
        <h2>Sequência de Coleta</h2>
        <p>Arraste os tubos para a área em ordem correta e clique em Validar.</p>
        <div class="quiz">
          <div class="bank" id="tube-bank">
            <img draggable="true" class="tube" data-id="1-hemocultura" src="/public/assets/tubes/hemocultura.png?v=30" alt="Hemocultura">
            <img draggable="true" class="tube" data-id="2-citrato" src="/public/assets/tubes/citrato-azul.png?v=30" alt="Citrato (Azul)">
            <img draggable="true" class="tube tube-vhs" data-id="3-vhs" src="/public/assets/tubes/vhs-preto.png?v=30" alt="VHS (Preto)" style="display:none">
            <img draggable="true" class="tube" data-id="4-soro" src="/public/assets/tubes/soro-vermelho.png?v=30" alt="Soro (Vermelho/Amarelo)">
            <img draggable="true" class="tube" data-id="5-heparina" src="/public/assets/tubes/heparina-verde.png?v=30" alt="Heparina (Verde)">
            <img draggable="true" class="tube" data-id="6-edta" src="/public/assets/tubes/edta-roxo.png?v=30" alt="EDTA (Roxo)">
            <img draggable="true" class="tube" data-id="7-fluoreto" src="/public/assets/tubes/fluoreto-cinza.png?v=30" alt="Fluoreto (Cinza)">
          </div>
          <div class="drop" id="tube-drop" aria-label="Área de Montagem"></div>
        </div>
        <div class="quiz-actions">
          <button id="btn-reset" class="btn ghost">↺ Resetar</button>
          <button id="btn-validate" class="btn">Validar</button>
          <button class="btn ghost" data-audio="/public/audios/audio-selecao-de-tubos.mp3">▶ Sequência (narração)</button>
        </div>
        <p id="quiz-feedback" class="feedback"></p>
      </section>

      <section id="tab-aplicacoes" class="tab">
        <h2>Tubos & Aplicações</h2>
        <p>Associe cada tubo à sua finalidade/exemplos.</p>
        <div class="puzzle">
          <div class="left" id="puzzle-left">
            <div class="piece" draggable="true" data-key="hemocultura">Hemocultura (Microbiologia)</div>
            <div class="piece" draggable="true" data-key="citrato">Azul – Citrato (Coagulação: TP/TTPa)</div>
            <div class="piece" draggable="true" data-key="soro">Vermelho/Amarelo – Soro (Bioquímica/Sorologia/Hormônios)</div>
            <div class="piece" draggable="true" data-key="heparina">Verde – Heparina (Bioquímica/Eletrólitos)</div>
            <div class="piece" draggable="true" data-key="edta">Roxo – EDTA (Hematologia: Hemograma)</div>
            <div class="piece" draggable="true" data-key="fluoreto">Cinza – Fluoreto + EDTA (Glicose/Lactato)</div>
            <div class="piece" draggable="true" data-key="vhs">Preto – VHS (Velocidade de Hemossedimentação)</div>
          </div>
          <div class="right" id="puzzle-right">
            <div class="slot" data-accept="hemocultura">Microbiologia (bactérias/fungos)</div>
            <div class="slot" data-accept="citrato">Coagulação (TP, TTPa)</div>
            <div class="slot" data-accept="soro">Bioquímica / Sorologia / Hormônios</div>
            <div class="slot" data-accept="heparina">Bioquímica / Eletrólitos</div>
            <div class="slot" data-accept="edta">Hematologia (Hemograma)</div>
            <div class="slot" data-accept="fluoreto">Glicose / Lactato (inibe glicólise)</div>
            <div class="slot" data-accept="vhs">Velocidade de Hemossedimentação (VHS)</div>
          </div>
        </div>
        <div class="audio-controls" style="margin-top:8px">
          <button class="btn ghost" data-audio="/public/audios/audio-selecao-de-tubos.mp3">▶ Seleção de tubos (narração)</button>
        </div>
      </section>

      <section id="tab-indices" class="tab">
        <h2>Índices de Referência</h2>
        <div class="tables">
          <details open>
            <summary>Hemograma — Homens</summary>
            <ul>
              <li>Hemácias: 4,2 a 5,9 milhões/µL</li><li>Hemoglobina: 13,0 a 18,0 g/dL</li><li>Hematócrito: 38 a 52%</li><li>VCM: 80 a 100 fL</li><li>HCM: 27 a 32 pg</li><li>CHCM: 31 a 36 g/dL</li><li>RDW: 10 a 16%</li><li>Leucócitos totais: 4.000 a 11.000/µL</li><li>Neutrófilos bastonetes: 0 a 800/µL</li><li>Neutrófilos segmentados: 1.600 a 8.000/µL</li><li>Linfócitos: 900 a 4.000/µL</li><li>Monócitos: 100 a 1.000/µL</li><li>Eosinófilos: 0 a 500/µL</li><li>Basófilos: 0 a 200/µL</li><li>Plaquetas: 140.000 a 450.000/µL</li>
            </ul>
          </details>
          <details>
            <summary>Hemograma — Mulheres</summary>
            <ul>
              <li>Hemácias: 3,9 a 5,4 milhões/µL</li><li>Hemoglobina: 12,0 a 16,0 g/dL</li><li>Hematócrito: 35 a 47%</li><li>VCM: 80 a 100 fL</li><li>HCM: 27 a 32 pg</li><li>CHCM: 31 a 36 g/dL</li><li>RDW: 10 a 16%</li><li>Leucócitos totais: 4.000 a 11.000/µL</li><li>Neutrófilos bastonetes: 0 a 800/µL</li><li>Neutrófilos segmentados: 1.600 a 8.000/µL</li><li>Linfócitos: 900 a 4.000/µL</li><li>Monócitos: 100 a 1.000/µL</li><li>Eosinófilos: 0 a 500/µL</li><li>Basófilos: 0 a 200/µL</li><li>Plaquetas: 150.000 a 450.000/µL</li>
            </ul>
          </details>
          <details>
            <summary>Leucograma na gravidez</summary>
            <ul>
              <li>1º tri — Leucócitos: 5.700–13.600/µL; Neutrófilos: 3.600–10.100/µL; Linfócitos: 1.100–3.600/µL</li>
              <li>2º tri — Leucócitos: 5.600–14.800/µL; Neutrófilos: 3.800–12.300/µL; Linfócitos: 900–3.900/µL</li>
              <li>3º tri — Leucócitos: 5.900–16.900/µL; Neutrófilos: 3.900–13.100/µL; Linfócitos: 100–3.600/µL</li>
            </ul>
          </details>
          <details>
            <summary>Observação</summary>
            <ul>
              <li>Os valores podem variar conforme laboratório, kits e equipamentos utilizados.</li>
            </ul>
          </details>
        </div>
      </section>

      <!-- GLOSSÁRIO -->
      <section id="tab-glossario" class="tab">
        <h2>Glossário</h2>
        <div class="box">
          <h3>Mini Glossário Interativo</h3>
          <div id="tutor-gloss-groups" style="display:grid;gap:12px">
            <details open>
              <summary>Imunologia</summary>
              <ul class="bullets">
                <li><b>Antígeno:</b> molécula reconhecida pelo sistema imune.</li>
                <li><b>Anticorpo:</b> proteína de defesa (Ig) que se liga ao antígeno.</li>
                <li><b>Avidêz/Afinidade:</b> força global vs. força pontual da ligação Ag-Ac.</li>
              </ul>
            </details>
            <details>
              <summary>Microbiologia</summary>
              <ul class="bullets">
                <li><b>Gram-positivo/negativo:</b> classificação por parede celular e coloração.</li>
                <li><b>Antibiograma:</b> teste de sensibilidade a antimicrobianos.</li>
                <li><b>Colônia:</b> crescimento visível de microrganismos em meio sólido.</li>
              </ul>
            </details>
            <details>
              <summary>Hematologia</summary>
              <ul class="bullets">
                <li><b>VCM:</b> volume corpuscular médio dos eritrócitos.</li>
                <li><b>RDW:</b> amplitude de distribuição dos glóbulos vermelhos.</li>
                <li><b>Leucocitose:</b> aumento de leucócitos circulantes.</li>
              </ul>
            </details>
          </div>
        </div>
      </section>
    </div>

    <aside class="tab box" style="height: fit-content;">
      <div class="row" style="gap:10px; align-items:center;">
        <img src="/public/assets/branding/avatar-tutor.png?v=30" alt="Tutor" style="width:56px;height:56px;border-radius:50%;object-fit:cover">
        <h3 style="margin:0">Tutor IA</h3>
      </div>
      <div id="tutor-feed" style="margin-top:8px;max-height:240px;overflow:auto;"></div>
      <div class="row" style="margin-top:8px">
        <input id="tutor-input" placeholder="Pergunte, responda ao quiz, peça correção…" style="flex:1;padding:8px;border-radius:10px;border:1px solid rgba(255,255,255,.15);background:#0c182b;color:#e6f0ff"/>
        <button id="tutor-ask" class="btn">Enviar</button>
      </div>
      <button id="tutor-corrigir" class="btn ghost" style="margin-top:8px">Corrigir sequência</button>
    </aside>
  </main>
  
<!-- =========================
     ABA TUTOR (TRILHA)
     ========================= -->
<section id="tab-tutor" class="tab" hidden>
  <h2>Tutor • Trilhas</h2>

  <nav class="pill-nav" aria-label="Navegação da trilha">
    <a href="#mod-imuno">Imunologia e Sorologia</a>
    <a href="#mod-micro">Microbiologia Clínica</a>
    <a href="#mod-casos">Casos Clínicos Integrados</a>
  </nav>

  <!-- IMUNO -->
  <article id="mod-imuno" class="box module">
    <header class="module-header">
      <h3>Imunologia e Sorologia</h3>
      <p class="module-sub">Base para interpretação de testes imunológicos no laboratório clínico.</p>
    </header>

    <details class="topic" open>
      <summary class="topic-title">Reações antígeno-anticorpo</summary>
      <div class="topic-body">
        <ul class="bullets">
          <li>Conceitos-chave: epítopo, parátopo, afinidade vs. avidez, especificidade e sensibilidade.</li>
          <li>Formatos: <b>precipitação</b>, <b>aglutinação</b>, <b>imunofluorescência</b>, <b>imunocromatografia</b>.</li>
          <li>Pré-analítico: hemólise, lipemia, volume insuficiente, janela imunológica.</li>
        </ul>
        <div class="actions row wrap" style="margin-top:8px">
          <button class="btn" data-action="open-quiz" data-target="imuno-reacoes">Abrir Quiz</button>
          <a class="btn ghost" target="_blank" href="https://chatgpt.com/g/g-68d6e0109858819198be5119b77a5a30-tutor-de-estudos-para-enfermagem">Pergunte ao Tutor (IA)</a>
        </div>
      </div>
    </details>

    <details class="topic">
      <summary class="topic-title">Testes rápidos (HIV, HBsAg, dengue etc.)</summary>
      <div class="topic-body">
        <ul class="bullets">
          <li>Fluxo lateral: bandas controle e teste; leitura em tempo correto.</li>
          <li>HIV: testes combinados (Ag p24/Ac), confirmar resultados indeterminados.</li>
          <li>Dengue: NS1 (fase precoce) vs. IgM/IgG (fase tardia).</li>
        </ul>
        <div class="actions row wrap" style="margin-top:8px">
          <button class="btn" data-action="open-quiz" data-target="imuno-rapidos">Abrir Quiz</button>
          <a class="btn ghost" target="_blank" href="https://chatgpt.com/g/g-68d6e0109858819198be5119b77a5a30-tutor-de-estudos-para-enfermagem">Pergunte ao Tutor (IA)</a>
        </div>
      </div>
    </details>

    <details class="topic">
      <summary class="topic-title">Ensaios por ELISA</summary>
      <div class="topic-body">
        <ul class="bullets">
          <li>Tipos: <b>direto</b>, <b>indireto</b>, <b>sandwich</b>, <b>competitivo</b>.</li>
          <li>Curva padrão, linearidade, LOD/LOQ, controles.</li>
          <li>Erros: lavagem insuficiente, tempos/temperatura, contaminação cruzada.</li>
        </ul>
        <div class="actions row wrap" style="margin-top:8px">
          <button class="btn" data-action="open-quiz" data-target="imuno-elisa">Abrir Quiz</button>
          <a class="btn ghost" target="_blank" href="https://chatgpt.com/g/g-68d6e0109858819198be5119b77a5a30-tutor-de-estudos-para-enfermagem">Pergunte ao Tutor (IA)</a>
        </div>
      </div>
    </details>
  </article>

  <!-- MICRO -->
  <article id="mod-micro" class="box module">
    <header class="module-header">
      <h3>Microbiologia Clínica</h3>
      <p class="module-sub">Do preparo da amostra à interpretação de resultados culturais.</p>
    </header>

    <details class="topic" open>
      <summary class="topic-title">Meios de cultura e coloração de Gram</summary>
      <div class="topic-body">
        <ul class="bullets">
          <li>Meios: não seletivos (Ágar sangue), seletivos (MacConkey), diferenciais (TCBS, Mannitol Salt).</li>
          <li>Gram: cristal violeta → lugol → álcool/acetona → safranina; atenção aos artefatos.</li>
          <li>Qualidade da amostra: volume, tempo de transporte, swab vs. aspirado.</li>
        </ul>
        <div class="actions row wrap" style="margin-top:8px">
          <button class="btn" data-action="open-quiz" data-target="micro-gram">Abrir Quiz</button>
          <a class="btn ghost" target="_blank" href="https://chatgpt.com/g/g-68d6e0109858819198be5119b77a5a30-tutor-de-estudos-para-enfermagem">Pergunte ao Tutor (IA)</a>
        </div>
      </div>
    </details>

    <details class="topic">
      <summary class="topic-title">Identificação de bactérias comuns</summary>
      <div class="topic-body">
        <ul class="bullets">
          <li>Cocos G+: Staphylococcus (catalase +) vs. Streptococcus (catalase −).</li>
          <li>Bacilos G−: Enterobactérias (fermentadores) vs. não fermentadores.</li>
          <li>Testes: catalase, coagulase, oxidase, IMViC, urease, TSI/KIA.</li>
        </ul>
        <div class="actions row wrap" style="margin-top:8px">
          <button class="btn" data-action="open-quiz" data-target="micro-id">Abrir Quiz</button>
          <a class="btn ghost" target="_blank" href="https://chatgpt.com/g/g-68d6e0109858819198be5119b77a5a30-tutor-de-estudos-para-enfermagem">Pergunte ao Tutor (IA)</a>
        </div>
      </div>
    </details>

    <details class="topic">
      <summary class="topic-title">Resistência bacteriana e antibiograma</summary>
      <div class="topic-body">
        <ul class="bullets">
          <li>Disco-difusão (Kirby-Bauer) vs. MIC (microdiluição).</li>
          <li>Breakpoints (CLSI/EUCAST) e S/I/R.</li>
          <li>Mecanismos: β-lactamases (ESBL, carbapenemases), alteração de alvo, efluxo.</li>
        </ul>
        <div class="actions row wrap" style="margin-top:8px">
          <button class="btn" data-action="open-quiz" data-target="micro-atb">Abrir Quiz</button>
          <a class="btn ghost" target="_blank" href="https://chatgpt.com/g/g-68d6e0109858819198be5119b77a5a30-tutor-de-estudos-para-enfermagem">Pergunte ao Tutor (IA)</a>
        </div>
      </div>
    </details>
  </article>

  <!-- CASOS -->
  <article id="mod-casos" class="box module">
    <header class="module-header">
      <h3>Casos Clínicos Integrados</h3>
      <p class="module-sub">Cenários práticos que conectam coleta, processamento e interpretação.</p>
    </header>

    <div class="case-grid">
      <section class="case-card">
        <h4>Infecção do Trato Urinário (ITU)</h4>
        <ul class="bullets">
          <li><b>Objetivo:</b> coleta correta (jato médio) e interpretação de EAS + urocultura.</li>
          <li><b>Pontos-chave:</b> contaminação, UFC/mL, Gram de urina positiva.</li>
          <li><b>Desfecho:</b> decisão baseada no antibiograma.</li>
        </ul>
        <div class="actions row wrap">
          <button class="btn" data-action="start-case" data-case="caso-itu">Iniciar Caso</button>
          <button class="btn ghost" data-action="open-quiz" data-target="caso-itu">Quiz do Caso</button>
        </div>
      </section>

      <section class="case-card">
        <h4>Suspeita de Diabetes</h4>
        <ul class="bullets">
          <li><b>Objetivo:</b> interpretar glicemia, HbA1c e exames complementares.</li>
          <li><b>Pontos-chave:</b> jejum, variáveis pré-analíticas, correlação clínica.</li>
          <li><b>Desfecho:</b> relatório integrado com recomendações laboratoriais.</li>
        </ul>
        <div class="actions row wrap">
          <button class="btn" data-action="start-case" data-case="caso-diabetes">Iniciar Caso</button>
          <button class="btn ghost" data-action="open-quiz" data-target="caso-diabetes">Quiz do Caso</button>
        </div>
      </section>

      <section class="case-card">
        <h4>Alteração Hepática</h4>
        <ul class="bullets">
          <li><b>Objetivo:</b> correlacionar TGO/TGP, GGT, FA, bilirrubinas e sorologias.</li>
          <li><b>Pontos-chave:</b> padrão citolítico vs. colestático, interferentes, confirmação.</li>
          <li><b>Desfecho:</b> hipóteses e próximos passos laboratoriais.</li>
        </ul>
        <div class="actions row wrap">
          <button class="btn" data-action="start-case" data-case="caso-hepatico">Iniciar Caso</button>
          <button class="btn ghost" data-action="open-quiz" data-target="caso-hepatico">Quiz do Caso</button>
        </div>
      </section>
    </div>
  </article>

  <!-- Suporte IA (mantido) -->
  <div class="box" style="margin-top:14px">
    <b>Suporte IA (Tutor):</b>
    <a href="https://chatgpt.com/g/g-68d6e0109858819198be5119b77a5a30-tutor-de-estudos-para-enfermagem" target="_blank" rel="noopener">
      Abrir Tutor de Estudos para Enfermagem
    </a>
  </div>
</section>

<!-- ====== ESTILOS LOCAIS DA ABA TUTOR ====== -->
<style>
  /* Escopo na seção Tutor */
  #tab-tutor .pill-nav{display:flex;gap:8px;flex-wrap:wrap;margin:8px 0 14px;}
  #tab-tutor .pill-nav a{padding:6px 10px;border:1px solid rgba(255,255,255,.12);border-radius:999px;text-decoration:none;color:var(--ink);background:rgba(255,255,255,.05);}
  #tab-tutor .module-header{margin-bottom:10px;}
  #tab-tutor .module-sub{color:var(--muted);margin-top:-4px;}
  #tab-tutor details.topic{border:1px solid rgba(255,255,255,.10);border-radius:12px;margin:10px 0;overflow:hidden;background:rgba(255,255,255,.03);}
  #tab-tutor summary.topic-title{list-style:none;cursor:pointer;padding:10px 12px;font-weight:600;}
  #tab-tutor .topic-body{padding:10px 12px 12px;border-top:1px solid rgba(255,255,255,.08);}
  #tab-tutor .bullets{margin:0;padding-left:18px;}
  #tab-tutor .bullets li{margin:6px 0;}
  #tab-tutor .actions{display:flex;gap:8px;flex-wrap:wrap;margin-top:10px;}
  #tab-tutor .case-grid{display:grid;grid-template-columns:repeat(auto-fit,minmax(260px,1fr));gap:12px;margin-top:6px;}
  #tab-tutor .case-card{background:rgba(255,255,255,.04);border:1px solid rgba(255,255,255,.08);border-radius:12px;padding:12px;}
</style>

<!-- ====== SCRIPT DA ABA TUTOR (rolagem + quizzes/casos) ====== -->
<script>
  (function () {
    // --- Navegação suave dentro da aba Tutor ---
    const tutorSection = document.getElementById('tab-tutor');
    if (tutorSection) {
      tutorSection.querySelectorAll('.pill-nav a[href^="#"]').forEach(a => {
        a.addEventListener('click', (e) => {
          const id = a.getAttribute('href');
          const el = tutorSection.querySelector(id);
          if (el) {
            e.preventDefault();
            el.scrollIntoView({ behavior: 'smooth', block: 'start' });
            const firstDetails = el.querySelector('details.topic');
            if (firstDetails && !firstDetails.open) firstDetails.open = true;
          }
        });
      });
    }

    // --- Banco de QUIZZES (múltipla escolha) ---
    const QUIZZES = {
      'imuno-reacoes': [
        { q: 'Qual método detecta complexos Ag-Ac por migração capilar?', opts: ['ELISA', 'Imunocromatografia', 'Imunofluorescência'], a: 1 },
        { q: 'Qual termo descreve a força global da ligação Ag-Ac?', opts: ['Afinidade', 'Avidêz', 'Especificidade'], a: 1 },
        { q: 'Que fator pode levar a falso-negativo precoce em HIV?', opts: ['Lipemia', 'Janela imunológica', 'Hemólise'], a: 1 }
      ],
      'imuno-rapidos': [
        { q: 'Em dengue, NS1 é mais útil em qual fase?', opts: ['Fase precoce', 'Fase tardia', 'Convalescença'], a: 0 },
        { q: 'Banda de controle ausente no teste rápido significa:', opts: ['Resultado reagente', 'Resultado não reagente', 'Teste inválido'], a: 2 }
      ],
      'imuno-elisa': [
        { q: 'Formato ELISA ideal para antígeno com dois epítopos distintos:', opts: ['Direto', 'Indireto', 'Sandwich'], a: 2 },
        { q: 'Controle negativo alto no ELISA. Próxima ação?', opts: ['Liberar resultado', 'Repetir e revisar reagentes/contaminação', 'Ignorar controle'], a: 1 }
      ],
      'micro-gram': [
        { q: 'Qual meio é seletivo para Gram-negativos entéricos?', opts: ['Ágar sangue', 'MacConkey', 'TCBS'], a: 1 },
        { q: 'Safranina na coloração de Gram funciona como:', opts: ['Corante primário', 'Mordente', 'Contra-corante'], a: 2 }
      ],
      'micro-id': [
        { q: 'Teste que diferencia Staphylococcus de Streptococcus:', opts: ['Coagulase', 'Catalase', 'Oxidase'], a: 1 },
        { q: 'IMViC é aplicado principalmente a:', opts: ['Não fermentadores', 'Enterobactérias', 'Cocos Gram-positivos'], a: 1 }
      ],
      'micro-atb': [
        { q: 'MIC significa:', opts: ['Dose mínima eficaz', 'Menor concentração inibitória', 'Maior concentração tolerada'], a: 1 },
        { q: 'Categoria "I" (EUCAST) indica:', opts: ['Resistente', 'Sensível padrão', 'Sensibilidade aumentada por exposição'], a: 2 }
      ],
      // Quizzes dos CASOS
      'caso-itu': [
        { q: 'Urocultura com 10^5 UFC/mL de E. coli em jato médio sugere:', opts: ['Contaminação', 'Infecção provável', 'Colonização'], a: 1 },
        { q: 'Primeiro passo para reduzir contaminação na coleta:', opts: ['Jejum de 8h', 'Higienização adequada da genitália', 'Coleta pós-antibiótico'], a: 1 }
      ],
      'caso-diabetes': [
        { q: 'HbA1c ≥ 6,5% indica:', opts: ['Normal', 'Pré-diabetes', 'Diabetes'], a: 2 },
        { q: 'Para glicemia de jejum, o preparo correto é:', opts: ['12h de jejum + água liberada', '6h de jejum + sem água', 'Jejum opcional'], a: 0 }
      ],
      'caso-hepatico': [
        { q: 'Elevação predominante de TGO/TGP sugere padrão:', opts: ['Colestático', 'Citolítico', 'Hemolítico'], a: 1 },
        { q: 'Aumento de FA e GGT com bilirrubina direta elevada sugere:', opts: ['Colestase', 'Hepatite fulminante', 'Anemia hemolítica'], a: 0 }
      ]
    };

    // --- Banco de CASOS (enunciado + perguntas) ---
    const CASES = {
      'caso-itu': {
        title: 'Caso: Infecção do Trato Urinário (ITU)',
        intro: 'Paciente feminina, 26 anos, disúria e polaciúria há 2 dias. Sem febre. Urina jato médio coletada adequadamente.',
        quizId: 'caso-itu'
      },
      'caso-diabetes': {
        title: 'Caso: Suspeita de Diabetes',
        intro: 'Paciente masculino, 48 anos, poliúria, polidipsia. Glicemia casual 218 mg/dL. Solicita-se glicemia de jejum e HbA1c.',
        quizId: 'caso-diabetes'
      },
      'caso-hepatico': {
        title: 'Caso: Alteração Hepática',
        intro: 'Paciente 35 anos, icterícia leve, colúria. Exames mostram TGO/TGP elevadas e GGT/FA moderadas.',
        quizId: 'caso-hepatico'
      }
    };

    // --- UI: Diálogo de quizzes/casos (reaproveita #tutor-pop) ---
    const dlg = document.getElementById('tutor-pop');
    const dlgTitle = document.getElementById('tp-title');
    const dlgBody = document.getElementById('tp-text');
    const dlgClose = document.getElementById('tp-close');
    if (dlg && dlgClose) {
      dlgClose.addEventListener('click', () => dlg.close());
    }

    function renderQuiz(targetId, customTitle) {
      const items = QUIZZES[targetId];
      if (!items) return;

      let current = 0;
      let score = 0;

      dlgTitle.textContent = customTitle || 'Quiz';
      dlgBody.innerHTML = `
        <div id="quiz-wrap">
          <div id="quiz-q" class="badge"></div>
          <div id="quiz-opts" class="tables" style="margin:8px 0"></div>
          <div class="row end">
            <button id="quiz-next" class="btn">Responder</button>
          </div>
          <div id="quiz-feedback" class="feedback"></div>
        </div>
      `;

      const qEl = dlgBody.querySelector('#quiz-q');
      const optsEl = dlgBody.querySelector('#quiz-opts');
      const nextBtn = dlgBody.querySelector('#quiz-next');
      const fbEl = dlgBody.querySelector('#quiz-feedback');

      function paint() {
        const it = items[current];
        qEl.textContent = `Pergunta ${current + 1} de ${items.length}: ${it.q}`;
        optsEl.innerHTML = it.opts.map((opt, i) => `
          <label class="card" style="cursor:pointer">
            <input type="radio" name="opt" value="${i}"/> ${opt}
          </label>
        `).join('');
        fbEl.textContent = '';
        nextBtn.textContent = 'Responder';
      }

      function finish() {
        qEl.textContent = `Pontuação: ${score}/${items.length}`;
        optsEl.innerHTML = '';
        nextBtn.remove();
        fbEl.className = 'feedback ' + (score >= Math.ceil(items.length*0.7) ? 'ok' : 'bad');
        fbEl.textContent = score >= Math.ceil(items.length*0.7)
          ? 'Muito bom! Você atingiu o objetivo deste quiz.'
          : 'Revisite o conteúdo e tente novamente.';
      }

      nextBtn.addEventListener('click', () => {
        const sel = dlgBody.querySelector('input[name="opt"]:checked');
        if (!sel) { fbEl.textContent = 'Selecione uma alternativa.'; return; }
        const it = items[current];
        const choice = Number(sel.value);
        const correct = it.a;

        if (choice === correct) {
          fbEl.className = 'feedback ok';
          fbEl.textContent = '✔ Resposta correta!';
          score++;
        } else {
          fbEl.className = 'feedback bad';
          fbEl.textContent = `✖ Incorreto. Correta: "${it.opts[correct]}".`;
        }

        current++;
        if (current < items.length) {
          // pequena pausa visual
          setTimeout(paint, 450);
        } else {
          setTimeout(finish, 450);
        }
      });

      paint();
      dlg.showModal();
    }

    function renderCase(caseId) {
      const data = CASES[caseId];
      if (!data) return;
      dlgTitle.textContent = data.title;
      dlgBody.innerHTML = `
        <p style="margin-bottom:8px">${data.intro}</p>
        <div class="box" style="margin-top:6px">
          <h4>Questões do Caso</h4>
          <div id="case-area"></div>
        </div>
        <div class="row end" style="margin-top:8px">
          <button id="case-start-quiz" class="btn">Responder</button>
        </div>
      `;
      dlg.showModal();

      const btn = dlgBody.querySelector('#case-start-quiz');
      btn.addEventListener('click', () => {
        renderQuiz(data.quizId, data.title + ' • Quiz');
      });
    }

    // --- Ações de clique na aba Tutor ---
    if (tutorSection) {
      tutorSection.addEventListener('click', (e) => {
        const btn = e.target.closest('button, a.btn');
        if (!btn) return;
        const action = btn.getAttribute('data-action');
        if (!action) return;
        const target = btn.getAttribute('data-target');
        const caseId = btn.getAttribute('data-case');

        if (action === 'open-quiz' && target) {
          renderQuiz(target);
        }
        if (action === 'start-case' && caseId) {
          renderCase(caseId);
        }
      });
    }
  })();
</script>

  <footer class="app-footer">
    <div class="left">
      <small>© 2025 • Material educacional. Não substitui treinamento supervisionado.</small>
    </div>
    <div class="right">
      <img src="/public/assets/branding/logo-haras.png?v=30" alt="HarasTech"/>
      <small>Desenvolvido por HarasTech • <a href="mailto:harastech@outlook.com">harastech@outlook.com</a></small>
    </div>
  </footer>

  <dialog id="settings">
    <h3>Configurações</h3>
    <label class="row">
      <span>Áudio ambiente</span>
      <input type="checkbox" id="toggle-ambiente"/>
    </label>
    <label>Volume do ambiente
      <input type="range" id="ambient-vol" min="0" max="100" value="35"/>
    </label>
    <div class="row end" style="margin-top:8px">
      <button id="save-settings" class="btn">Salvar</button>
      <button id="close-settings" class="btn ghost">Fechar</button>
    </div>
  </dialog>

  <dialog id="tutor-pop" style="max-width:720px">
    <div class="row" style="gap:12px;align-items:center;margin-bottom:6px">
      <img src="/public/assets/branding/avatar-tutor.png" alt="Tutor" style="width:56px;height:56px;border-radius:50%;object-fit:cover"/>
      <h3 id="tp-title" style="margin:0"></h3>
    </div>
    <div id="tp-text"></div>
    <div class="row end" style="margin-top:12px">
      <button id="tp-close" class="btn">Fechar</button>
    </div>
  </dialog>

  <script src="/scripts.js?v=30" defer></script>
  <script>
/* ===== QUIZZES E CASOS (mínimo funcional) ===== */
const QUIZZES = {
  'imuno-reacoes': [
    { q:'Qual método detecta complexos Ag-Ac por migração capilar?', opts:['ELISA','Imunocromatografia','Imunofluorescência'], a:1 },
    { q:'Qual termo descreve a força global da ligação Ag-Ac?', opts:['Afinidade','Avidêz','Especificidade'], a:1 },
    { q:'Falso-negativo precoce em HIV é comum por:', opts:['Lipemia','Janela imunológica','Hemólise'], a:1 }
  ],
  'imuno-rapidos': [
    { q:'Em dengue, NS1 é mais útil na:', opts:['Fase precoce','Fase tardia','Convalescença'], a:0 },
    { q:'Sem banda de controle no teste rápido o resultado é:', opts:['Reagente','Não reagente','Inválido'], a:2 }
  ],
  'imuno-elisa': [
    { q:'ELISA ideal para antígeno com 2 epítopos distintos:', opts:['Direto','Indireto','Sandwich'], a:2 },
    { q:'Controle negativo alto no ELISA →', opts:['Liberar','Repetir e revisar contaminação','Ignorar'], a:1 }
  ],
  'micro-gram': [
    { q:'Meio seletivo para Gram− entéricos:', opts:['Ágar sangue','MacConkey','TCBS'], a:1 },
    { q:'Safranina na coloração de Gram é:', opts:['Corante primário','Mordente','Contra-corante'], a:2 }
  ],
  'micro-id': [
    { q:'Teste que diferencia Staph de Strep:', opts:['Coagulase','Catalase','Oxidase'], a:1 },
    { q:'IMViC aplica-se principalmente a:', opts:['Não fermentadores','Enterobactérias','Cocos G+'], a:1 }
  ],
  'micro-atb': [
    { q:'MIC significa:', opts:['Dose mínima eficaz','Menor concentração inibitória','Maior concentração tolerada'], a:1 },
    { q:'Categoria "I" (EUCAST) indica:', opts:['Resistente','Sensível padrão','Sensibilidade aumentada por exposição'], a:2 }
  ],
  'caso-itu': [
    { q:'Urocultura 10^5 UFC/mL E. coli em jato médio sugere:', opts:['Contaminação','Infecção provável','Colonização'], a:1 },
    { q:'Para reduzir contaminação na coleta:', opts:['Jejum 8h','Higienizar genitália','Coletar pós-ATB'], a:1 }
  ],
  'caso-diabetes': [
    { q:'HbA1c ≥ 6,5% indica:', opts:['Normal','Pré-diabetes','Diabetes'], a:2 },
    { q:'Preparo correto para glicemia de jejum:', opts:['12h jejum + água liberada','6h sem água','Jejum opcional'], a:0 }
  ],
  'caso-hepatico': [
    { q:'Predomínio TGO/TGP sugere padrão:', opts:['Colestático','Citolítico','Hemolítico'], a:1 },
    { q:'FA/GGT altas + bilirrubina direta ↑ sugere:', opts:['Colestase','Hepatite fulminante','Anemia hemolítica'], a:0 }
  ]
};

const CASES = {
  'caso-itu': { title:'Caso: Infecção do Trato Urinário (ITU)', intro:'Feminina, 26a, disúria/polaciúria há 2 dias. Coleta jato médio adequada.', quizId:'caso-itu' },
  'caso-diabetes': { title:'Caso: Suspeita de Diabetes', intro:'Masculino, 48a, poliúria/polidipsia. Glicemia casual 218 mg/dL.', quizId:'caso-diabetes' },
  'caso-hepatico': { title:'Caso: Alteração Hepática', intro:'35a, icterícia leve, colúria. TGO/TGP elevadas; GGT/FA moderadas.', quizId:'caso-hepatico' }
};

/* ===== DIÁLOGO REUTILIZADO (#tutor-pop) ===== */
function getDlg() {
  const dlg = document.getElementById('tutor-pop');
  const t = document.getElementById('tp-title');
  const b = document.getElementById('tp-text');
  return { dlg, t, b };
}

/* ===== RENDER QUIZ ===== */
function openQuiz(targetId, titleOverride) {
  const items = QUIZZES[targetId];
  if (!items || !items.length) { alert('Quiz não encontrado.'); return; }

  const { dlg, t, b } = getDlg();
  t.textContent = titleOverride || 'Quiz';
  let i = 0, score = 0;

  function paint() {
    const it = items[i];
    b.innerHTML = `
      <div class="badge" style="margin-bottom:8px">Pergunta ${i+1} de ${items.length}</div>
      <p style="margin:6px 0">${it.q}</p>
      <div id="opts" class="tables" style="margin:8px 0">
        ${it.opts.map((o, idx) => `
          <label class="card" style="cursor:pointer">
            <input type="radio" name="opt" value="${idx}"/> ${o}
          </label>`).join('')}
      </div>
      <div class="row end"><button id="answer" class="btn">Responder</button></div>
      <div id="fb" class="feedback" style="min-height:24px"></div>
    `;
    b.querySelector('#answer').onclick = () => {
      const sel = b.querySelector('input[name="opt"]:checked');
      if (!sel) { b.querySelector('#fb').textContent='Selecione uma alternativa.'; return; }
      const ok = Number(sel.value) === it.a;
      b.querySelector('#fb').className = 'feedback ' + (ok ? 'ok' : 'bad');
      b.querySelector('#fb').textContent = ok ? '✔ Correto!' : `✖ Errado. Correta: "${it.opts[it.a]}".`;
      if (ok) score++;
      i++;
      if (i < items.length) setTimeout(paint, 450);
      else setTimeout(() => {
        b.innerHTML = `
          <div class="badge">Pontuação</div>
          <p style="margin:8px 0; font-weight:700">${score} / ${items.length}</p>
          <div class="row end"><button class="btn" id="closeQuiz">Concluir</button></div>
        `;
        b.querySelector('#closeQuiz').onclick = () => dlg.close();
      }, 450);
    };
  }

  paint();
  dlg.showModal();
}

/* ===== RENDER CASO ===== */
function openCase(caseId) {
  const data = CASES[caseId];
  if (!data) { alert('Caso não encontrado.'); return; }
  const { dlg, t, b } = getDlg();
  t.textContent = data.title || 'Caso Clínico';
  b.innerHTML = `
    <p style="margin-bottom:8px">${data.intro || ''}</p>
    <div class="row end" style="margin-top:12px">
      <button id="startCaseQuiz" class="btn">Responder Quiz do Caso</button>
    </div>
  `;
  b.querySelector('#startCaseQuiz').onclick = () => openQuiz(data.quizId, (data.title || '') + ' • Quiz');
  dlg.showModal();
}

/* ===== LIGA OS BOTÕES (funciona em toda a página) ===== */
document.addEventListener('click', (e) => {
  const btn = e.target.closest('[data-action]');
  if (!btn) return;
  const action = btn.dataset.action;
  if (action === 'open-quiz') {
    const id = btn.dataset.target;
    if (id) openQuiz(id);
  }
  if (action === 'start-case') {
    const id = btn.dataset.case;
    if (id) openCase(id);
  }
});
</script>
</body>
</html>

